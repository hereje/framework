#!/usr/bin/env bash
set -e
. "$JL_WORKDIR/common"

cli_help() {
  echo "
Command: logs

Use: Helpful commands for dealing with project log files

Example: JL logs
"
exit 1
}

cli_log "Logs"

IFS=','

if [ "$PROJECT_NEST_SERVICES" ]
	then
		read -ra options <<< "$PROJECT_NEST_SERVICES"
    elif [ "$PROJECT_VITE_SERVICES" ]
	then
		read -ra options <<< "$PROJECT_VITE_SERVICES"
	fi

if [ -z "$options" ]
	then
		cli_log_error "No logs found"
		exit 1
	fi

cli_log "Available log files: "

# Define a variable to store the selected options
selected_option=""

# Loop through the array of strings and create a select menu
PS3="Select log: "
select opt in "${options[@]}"; do
    # If the user enters a number, add the corresponding string to the selected options
    if [[ "$REPLY" =~ ^[0-9]+$ ]] && (( "$REPLY" >= 1 && "$REPLY" <= "${#options[@]}" )); then
        selected_option+="${options[$REPLY-1]}"
        break
    else
        cli_log_error "Invalid option"
    fi
done

cli_log "What would you like to do with the $selected_option log?"

PS3=''
LOGOPTIONS=("Clear" "Watch" "Quit")

select opt in "${LOGOPTIONS[@]}"; do

    case $opt in
        "Clear")
            cli_log "Clearing $selected_option log"
            echo "" > logs/$selected_option.log &
            exit
            ;;
        "Watch")
           	cli_log "Watching $selected_option log"
           	tail -f logs/$selected_option.log
            ;;
	"Quit")
	    exit
	    ;;
        *) cli_log_error "Invalid option";;
    esac
done

